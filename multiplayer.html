<!DOCTYPE html>
<html lang="nl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Speel Mexico online tegen echte spelers. Het klassieke dobbelspel in multiplayer versie met matchmaking.">
    <meta name="theme-color" content="#0D5E3A">
    <title>üé≤ Multiplayer - Koning Mexico</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;800&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: '#D4AF37',
                        'gold-light': '#FFD700',
                        'gold-dark': '#B8960F',
                        green: '#0D5E3A',
                        'green-light': '#1B7A4B',
                        red: '#8B0000',
                        'red-light': '#B22222',
                        'brown-dark': '#3E2723',
                        'brown-medium': '#5D4037',
                        cream: '#F5E6D3',
                        'cream-light': '#FFF8E7',
                    },
                    fontFamily: {
                        'heading': ['Cinzel', 'serif'],
                        'body': ['Open Sans', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link rel="icon" type="image/png" href="assets/favicon.png">

    <!-- Navigation Component -->
    <script src="navigation.js"></script>

    <!-- Apply dark mode immediately to prevent flash -->
    <script>
        (function() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.documentElement.classList.add('dark-mode');
            }
        })();
    </script>

    <style>
        /* Theme variables */
        :root {
            --bg-primary: #F5E6D3;
            --bg-secondary: #FFF8E7;
            --bg-card: #ffffff;
            --text-primary: #3E2723;
            --text-secondary: #5D4037;
            --border-color: #D4AF37;
            --color-gold: #D4AF37;
            --color-gold-light: #FFD700;
            --color-gold-dark: #B8960F;
            --color-green: #0D5E3A;
            --color-green-light: #1B7A4B;
            --color-red: #8B0000;
            --color-red-light: #B22222;
            --color-brown-dark: #3E2723;
            --color-brown-medium: #5D4037;
            --color-cream: #F5E6D3;
            --color-cream-light: #FFF8E7;
        }

        html.dark-mode,
        html.dark-mode body {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2a2a2a;
            --bg-card: #333333;
            --text-primary: #f0f0f0;
            --text-secondary: #d0d0d0;
            --border-color: #FFD700;
            --color-green: #4CAF50;
            --color-green-light: #66BB6A;
            --color-red: #EF5350;
            --color-red-light: #E57373;
        }

        body {
            background: linear-gradient(to bottom right, var(--bg-primary), var(--bg-secondary));
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
            font-family: 'Open Sans', sans-serif;
        }

        /* Dark mode: improve contrast for green/red text on gray backgrounds */
        html.dark-mode .text-green {
            color: #4CAF50 !important;
        }

        html.dark-mode .text-red {
            color: #EF5350 !important;
        }

        /* Revealed blind throw styling */
        .bg-yellow-100 {
            background-color: #FEF3C7;
        }

        html.dark-mode .bg-yellow-100 {
            background-color: #854D0E;
            color: #FEF3C7;
        }

        .hidden { display: none !important; }
        .game-screen { min-height: 80vh; }

        /* Player cards */
        .player-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        html.dark-mode .player-card {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
        }

        .player-card.active {
            box-shadow: 0 8px 24px rgba(212, 175, 55, 0.4);
            border: 3px solid var(--color-gold);
        }

        .player-card.player {
            border-left: 6px solid var(--color-green);
        }

        .player-card.opponent {
            border-left: 6px solid var(--color-red);
        }

        /* Dice styling */
        .dice {
            width: 70px;
            height: 70px;
            background: white !important;
            color: #000 !important;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease;
        }

        html.dark-mode .dice {
            box-shadow: 0 4px 16px rgba(255, 255, 255, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .dice.rolling {
            animation: diceRoll 0.5s ease;
        }

        @keyframes diceRoll {
            0%, 100% { transform: rotateX(0) rotateY(0); }
            25% { transform: rotateX(180deg) rotateY(0); }
            50% { transform: rotateX(180deg) rotateY(180deg); }
            75% { transform: rotateX(0) rotateY(180deg); }
        }

        /* Dice cup */
        .dice-cup-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            perspective: 1000px;
        }

        .dice-cup {
            width: 160px;
            height: 180px;
            background: linear-gradient(180deg, #5D4037 0%, #3E2723 100%);
            border-radius: 20px 20px 90px 90px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 18px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            border: 3px solid var(--color-gold-dark);
            transition: transform 0.6s ease;
            transform-style: preserve-3d;
        }

        .dice-cup.flipped {
            transform: rotateX(180deg);
        }

        .dice-cup.opponent-cup {
            background: linear-gradient(180deg, #8B0000 0%, #5D0000 100%);
            border-color: var(--color-red);
        }

        .dice-cup::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 35px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 50%;
        }

        .dice-container {
            display: flex;
            gap: 12px;
            position: relative;
            z-index: 2;
        }

        .dice.hidden {
            background: linear-gradient(135deg, #3E2723 0%, #5D4037 100%);
            color: transparent;
            user-select: none;
            position: relative;
        }

        .dice.hidden::after {
            content: '?';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--color-gold);
            font-size: 2.5rem;
            font-weight: bold;
        }

        /* Buttons */
        .btn-game {
            padding: 0.875rem 1.5rem;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-game:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-game:disabled {
            opacity: 0.5 !important;
            cursor: not-allowed !important;
            background: #666 !important;
            pointer-events: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-gold) 0%, var(--color-gold-light) 100%);
            color: var(--color-brown-dark);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--color-green) 0%, var(--color-green-light) 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--color-red) 0%, var(--color-red-light) 100%);
            color: white;
        }

        /* Throw result display */
        .throw-result {
            font-size: 3rem;
            font-weight: bold;
            font-family: 'Cinzel', serif;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .throw-result.mexico {
            color: var(--color-gold-light);
            animation: pulseMexico 1s ease infinite;
        }

        @keyframes pulseMexico {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Smooth transitions */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Pulse animation for waiting */
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        /* Shake animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        .shaking {
            animation: shake 0.5s ease;
        }

        /* Game info panel */
        .game-info {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-left: 6px solid var(--color-gold);
            color: var(--text-primary);
        }

        .game-info .text-brown-medium {
            color: var(--text-secondary) !important;
        }

        /* Status indicators */
        .status-online {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Leaderboard styles */
        .leaderboard-rank {
            font-size: 1.2em;
            font-weight: bold;
        }
        .leaderboard-rank.top-1 { color: #FFD700; }
        .leaderboard-rank.top-2 { color: #C0C0C0; }
        .leaderboard-rank.top-3 { color: #CD7F32; }

        /* Mobile optimizations */
        @media (max-width: 640px) {
            .dice {
                width: 60px;
                height: 60px;
                font-size: 2rem;
            }

            .dice-cup {
                width: 160px;
                height: 180px;
            }
        }
    </style>
</head>
<body class="font-body min-h-screen">

    <!-- Header -->
    <header class="bg-gradient-to-r from-green to-green-light py-4 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <a href="index.html" class="flex items-center gap-2 text-white font-semibold hover:text-gold-light transition">
                    <span>‚Üê</span>
                    <span>Terug</span>
                </a>
                <h1 class="text-2xl font-heading font-bold text-white">
                    üé≤ Multiplayer Mexico <span style="background: red; color: white; padding: 4px 8px; font-size: 14px; border-radius: 4px; margin-left: 10px;">V2.0 TEST</span>
                </h1>
            </div>
            <div class="flex gap-3 items-center">
                <!-- Icon Buttons -->
                <button id="darkModeToggle" class="px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-white text-2xl" title="Dark Mode Toggle">
                    <span id="darkModeIcon">üåô</span>
                </button>
                <button id="debugToggle" class="px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-white text-2xl" title="Debug Log Toggle">
                    üêõ
                </button>
                <!-- Live Stats -->
                <span id="liveStats" class="text-white text-sm px-3 py-1 rounded-lg" style="background: rgba(255,255,255,0.1);">
                    <span class="mr-2">üü¢ <span id="onlinePlayers">--</span></span>
                    <span class="mr-2">‚è≥ <span id="queuePlayers">--</span></span>
                    <span>üéÆ <span id="activeGames">--</span></span>
                </span>
                <span id="userDisplay" class="hidden text-white">
                    <span class="font-semibold" id="username"></span>
                    <span class="text-sm text-white text-opacity-80" id="eloRating"></span>
                </span>
                <button id="logoutBtn" class="hidden px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-semibold shadow-md">
                    Uitloggen
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">

        <!-- Login/Register Screen -->
        <div id="authScreen" class="game-screen">
            <div class="max-w-md mx-auto">
                <div class="rounded-2xl shadow-2xl p-8" style="background: var(--bg-card);">
                    <h1 class="text-3xl font-heading font-bold text-center mb-6" style="color: var(--color-gold);">
                        üéÆ Multiplayer Mexico
                    </h1>

                    <!-- Tab Selector -->
                    <div class="flex mb-6 border-b" style="border-color: var(--border-color);">
                        <button id="loginTab" class="flex-1 py-3 font-semibold border-b-2 transition" style="border-color: var(--color-gold); color: var(--text-primary);">
                            Inloggen
                        </button>
                        <button id="registerTab" class="flex-1 py-3 font-semibold transition hover:opacity-80" style="color: var(--text-secondary);">
                            Registreren
                        </button>
                    </div>

                    <!-- Login Form -->
                    <form id="loginForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2" style="color: var(--text-primary);">Gebruikersnaam</label>
                            <input type="text" id="loginUsername" required
                                class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition"
                                style="background: var(--bg-secondary); border-color: var(--border-color); color: var(--text-primary);"
                                placeholder="Jouw gebruikersnaam">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2" style="color: var(--text-primary);">Wachtwoord</label>
                            <input type="password" id="loginPassword" required
                                class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition"
                                style="background: var(--bg-secondary); border-color: var(--border-color); color: var(--text-primary);"
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <button type="submit" class="btn-game btn-primary w-full py-3 font-bold rounded-lg">
                            Inloggen
                        </button>
                    </form>

                    <!-- Register Form -->
                    <form id="registerForm" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-semibold mb-2" style="color: var(--text-primary);">Gebruikersnaam</label>
                            <input type="text" id="registerUsername" required minlength="3" maxlength="50"
                                class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition"
                                style="background: var(--bg-secondary); border-color: var(--border-color); color: var(--text-primary);"
                                placeholder="3-50 karakters">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2" style="color: var(--text-primary);">Email</label>
                            <input type="email" id="registerEmail" required
                                class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition"
                                style="background: var(--bg-secondary); border-color: var(--border-color); color: var(--text-primary);"
                                placeholder="jouw@email.com">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2" style="color: var(--text-primary);">Wachtwoord</label>
                            <input type="password" id="registerPassword" required minlength="6"
                                class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition"
                                style="background: var(--bg-secondary); border-color: var(--border-color); color: var(--text-primary);"
                                placeholder="Minimaal 6 karakters">
                        </div>
                        <button type="submit" class="btn-game btn-primary w-full py-3 font-bold rounded-lg">
                            Account Aanmaken
                        </button>
                    </form>

                    <!-- Guest Login -->
                    <div class="mt-6 pt-6" style="border-top: 1px solid var(--border-color);">
                        <button type="button" id="guestLoginBtn"
                            onclick="window.handleGuestLoginClick && window.handleGuestLoginClick(event)"
                            class="w-full py-3 px-4 font-semibold rounded-lg transition-all"
                            style="background: rgba(255, 215, 0, 0.1); border: 2px dashed var(--color-gold); color: var(--color-gold); touch-action: manipulation; min-height: 64px; cursor: pointer; -webkit-tap-highlight-color: rgba(255, 215, 0, 0.3); position: relative; z-index: 10;">
                            <span class="text-xl mr-2">üë§</span>
                            <span>Speel als Gast</span>
                            <span class="text-sm block mt-1 opacity-75">(Geen account nodig)</span>
                        </button>
                    </div>

                    <div id="authError" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm"></div>
                    <div id="authSuccess" class="hidden mt-4 p-3 bg-green-100 text-green-700 rounded-lg text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Lobby Screen -->
        <div id="lobbyScreen" class="game-screen hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                <!-- Main Lobby Area -->
                <div class="lg:col-span-2">
                    <div class="rounded-2xl shadow-xl p-6" style="background: var(--bg-card);">
                        <h2 class="text-2xl font-heading font-bold mb-4" style="color: var(--color-gold);">üéÆ Lobby</h2>

                        <!-- User Stats -->
                        <div class="rounded-xl p-4 mb-6" style="background: linear-gradient(135deg, var(--color-gold-light), var(--color-gold)); opacity: 0.2;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-2xl font-bold" id="lobbyUsername" style="color: var(--text-primary);"></div>
                                    <div class="text-sm" style="color: var(--text-secondary);">Power: <span id="lobbyElo" class="font-bold"></span></div>
                                </div>
                                <div class="text-right">
                                    <div class="text-3xl" id="lobbyEmoji">üë§</div>
                                    <div class="text-xs" style="color: var(--text-secondary);">
                                        <span id="lobbyWins">0</span>W - <span id="lobbyLosses">0</span>L
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Matchmaking Queue -->
                        <div id="queueIdle" class="text-center py-12">
                            <div class="text-6xl mb-4">üéØ</div>
                            <h3 class="text-xl font-heading font-bold mb-2" style="color: var(--text-primary);">Klaar om te spelen?</h3>
                            <p class="mb-6" style="color: var(--text-secondary);">Zoek een tegenstander en begin met spelen!</p>
                            <button id="joinQueueBtn" class="btn-game btn-primary px-8 py-4 text-lg rounded-xl shadow-lg">
                                üîç Zoek Tegenstander
                            </button>
                        </div>

                        <div id="queueSearching" class="hidden text-center py-12">
                            <div class="text-6xl mb-4 pulse-animation">‚è≥</div>
                            <h3 class="text-xl font-heading font-bold mb-2" style="color: var(--text-primary);">Zoeken naar tegenstander...</h3>
                            <p class="mb-4" style="color: var(--text-secondary);">We zoeken een speler met vergelijkbare Power</p>
                            <div class="text-sm mb-6" style="color: var(--text-secondary);">
                                Spelers in queue: <span id="queueCount" class="font-bold" style="color: var(--color-gold);">1</span>
                            </div>
                            <button id="leaveQueueBtn" class="btn-game btn-danger px-6 py-2 rounded-lg">
                                ‚ùå Annuleren
                            </button>
                        </div>

                        <div id="matchFound" class="hidden text-center py-12">
                            <div class="text-6xl mb-4">üéâ</div>
                            <h3 class="text-xl font-heading font-bold mb-2" style="color: var(--text-primary);">Tegenstander gevonden!</h3>
                            <div class="text-lg mb-4" style="color: var(--text-primary);">
                                Je speelt tegen: <span id="opponentNameMatch" class="font-bold" style="color: var(--color-gold);"></span>
                                (Power: <span id="opponentEloMatch"></span>)
                            </div>
                            <p style="color: var(--text-secondary);">Het spel begint zo...</p>
                        </div>
                    </div>
                </div>

                <!-- Leaderboard Sidebar -->
                <div>
                    <div class="rounded-2xl shadow-xl p-6" style="background: var(--bg-card);">
                        <h3 class="text-xl font-heading font-bold mb-4 flex items-center gap-2">
                            <span>üèÜ</span>
                            <span style="color: var(--color-gold);">Top Spelers</span>
                        </h3>
                        <div id="leaderboardList" class="space-y-3">
                            <div class="text-center py-8" style="color: var(--text-secondary);">
                                <div class="text-4xl mb-2">üìä</div>
                                <div class="text-sm">Laden...</div>
                            </div>
                        </div>
                        <button id="refreshLeaderboard" class="w-full mt-4 py-2 text-sm rounded-lg transition" style="background: var(--bg-secondary); color: var(--text-primary);">
                            üîÑ Ververs
                        </button>
                    </div>

                    <!-- Recent Games -->
                    <div class="rounded-2xl shadow-xl p-6 mt-6" style="background: var(--bg-card);">
                        <h3 class="text-xl font-heading font-bold mb-4 flex items-center gap-2">
                            <span>üìú</span>
                            <span style="color: var(--accent-color);">Recente Games</span>
                        </h3>
                        <div id="recentGamesList" class="space-y-2">
                            <div class="text-center py-8" style="color: var(--text-secondary);">
                                <div class="text-4xl mb-2">üéÆ</div>
                                <div class="text-sm">Geen games gespeeld</div>
                            </div>
                        </div>
                    </div>

                    <!-- New Players -->
                    <div class="rounded-2xl shadow-xl p-6 mt-6" style="background: var(--bg-card);">
                        <h3 class="text-xl font-heading font-bold mb-4 flex items-center gap-2">
                            <span>üëã</span>
                            <span style="color: var(--accent-color);">Nieuwe Spelers</span>
                        </h3>
                        <div id="newPlayersList" class="space-y-2">
                            <div class="text-center py-8" style="color: var(--text-secondary);">
                                <div class="text-4xl mb-2">üë§</div>
                                <div class="text-sm">Laden...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Debug Panel -->
                    <div class="rounded-2xl shadow-xl p-4 mt-6" style="background: #1a1a1a; border: 2px solid var(--color-gold);">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-sm font-bold" style="color: var(--color-gold);">üîß Debug Panel</h3>
                            <button id="toggleDebugPanel" class="text-xs px-2 py-1 rounded" style="background: var(--color-gold); color: #000;">
                                ‚ñº Collapse
                            </button>
                        </div>
                        <div id="debugPanelContent" class="space-y-2 text-xs font-mono">
                            <!-- Connection Status -->
                            <div class="border-b pb-2" style="border-color: #333;">
                                <div class="font-bold mb-1" style="color: #00ff00;">üì° Verbinding:</div>
                                <div id="debugSocketStatus" style="color: #aaa;">Bezig met verbinden...</div>
                            </div>

                            <!-- Queue Status -->
                            <div class="border-b pb-2" style="border-color: #333;">
                                <div class="font-bold mb-1" style="color: #00ff00;">üîç Queue Status:</div>
                                <div id="debugQueueStatus" style="color: #aaa;">Niet in queue</div>
                                <div id="debugQueueSize" style="color: #aaa;">Spelers in queue: <span class="font-bold" style="color: var(--color-gold);">0</span></div>
                            </div>

                            <!-- Matchmaking Events -->
                            <div class="border-b pb-2" style="border-color: #333;">
                                <div class="font-bold mb-1" style="color: #00ff00;">üéÆ Matchmaking:</div>
                                <div id="debugMatchStatus" style="color: #aaa;">Wachten...</div>
                            </div>

                            <!-- Live Event Log -->
                            <div>
                                <div class="font-bold mb-1" style="color: #00ff00;">üìã Event Log:</div>
                                <div id="debugEventLog" style="color: #aaa; max-height: 200px; overflow-y: auto; line-height: 1.4;">
                                    <div style="opacity: 0.6;">Wachten op events...</div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex gap-2 mt-2">
                                <button id="copyDebugLog" class="flex-1 py-1 text-xs rounded" style="background: var(--color-gold); color: #000;">
                                    üìã Copy Log
                                </button>
                                <button id="clearDebugLog" class="flex-1 py-1 text-xs rounded" style="background: #333; color: #fff;">
                                    üóëÔ∏è Clear Log
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="game-screen hidden">
            <div class="max-w-4xl mx-auto">

                <!-- Lives Display -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <!-- Player -->
                    <div class="player-card player" id="playerCard">
                        <div class="text-center">
                            <div class="text-xs font-semibold mb-2" style="color: var(--color-green);">üë§ JIJ</div>
                            <div class="text-6xl" id="myLives">‚öÖ</div>
                            <div class="text-xs mt-2" style="color: var(--text-secondary);">Levens</div>
                        </div>
                    </div>

                    <!-- Opponent -->
                    <div class="player-card opponent" id="opponentCard">
                        <div class="text-center">
                            <div class="text-xs font-semibold mb-2" style="color: var(--color-red);"><span id="opponentCardLabel">üéØ TEGENSTANDER</span></div>
                            <div class="text-6xl" id="opponentLives">‚öÖ</div>
                            <div class="text-xs mt-2" style="color: var(--text-secondary);">Levens</div>
                        </div>
                    </div>
                </div>

                <!-- Last Round Summary (Compact) -->
                <div id="lastRoundSummary" class="rounded-lg p-3 mb-4 border-l-4 hidden" style="background: var(--bg-card); border-color: var(--color-gold);">
                    <div class="flex items-center justify-between">
                        <div id="lastRoundContent" class="text-xs flex-1" style="color: var(--text-primary);">
                            <!-- Content filled by JS -->
                        </div>
                        <button id="closeSummaryBtn" class="text-xs ml-2 px-2 py-1 rounded transition hover:opacity-80" style="background: var(--text-secondary); color: white;">‚úï</button>
                    </div>
                </div>

                <!-- Throw History (Both Players) with Game Info -->
                <div id="throwHistoryDisplay" class="rounded-lg shadow-lg p-3 mb-6 border-l-4 border-gold hidden" style="background: var(--bg-card); border-color: var(--color-gold);">
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <!-- Player throws (left) -->
                        <div>
                            <div class="text-xs font-semibold mb-1" style="color: var(--color-green);">üë§ Jij:</div>
                            <div id="playerThrowHistoryItems" class="space-y-1">
                                <!-- Player throw history -->
                            </div>
                        </div>
                        <!-- Opponent throws (right) -->
                        <div>
                            <div class="text-xs font-semibold mb-1" style="color: var(--color-red);"><span id="opponentThrowHistoryLabel">üéØ Tegenstander</span>:</div>
                            <div id="opponentThrowHistoryItems" class="space-y-1">
                                <!-- Opponent throw history -->
                            </div>
                        </div>
                    </div>
                    <!-- Game Info integrated below -->
                    <div id="gameInfoInHistory" class="border-t pt-2 text-xs" style="border-color: var(--border-color); color: var(--text-secondary);">
                        <!-- Game info will be inserted here -->
                    </div>
                </div>

                <!-- Game Board -->
                <div>
                    <div class="rounded-2xl shadow-xl p-6" style="background: var(--bg-card);">

                        <!-- Turn Indicator with Buttons -->
                        <div class="relative mb-6">
                            <button id="leaveGameBtn" class="absolute top-2 left-2 px-3 py-1 text-xs rounded-lg transition hover:opacity-80" style="background: var(--color-red); color: white;" title="Verlaat het spel">
                                üö™ Verlaten
                            </button>
                            <div id="turnIndicator" class="text-center py-4 rounded-xl font-bold text-lg"></div>
                            <button id="resetUIBtn" class="absolute top-2 right-2 px-3 py-1 text-xs rounded-lg transition" style="background: var(--color-red); color: white;" title="Reset UI als het spel vastloopt">
                                üîÑ Reset UI
                            </button>
                        </div>

                        <!-- Dice Cups -->
                        <div class="flex justify-center gap-6 mb-6">
                            <!-- Player's Dice Cup -->
                            <div class="dice-cup-wrapper">
                                <div class="text-xs mb-2 text-center font-semibold" style="color: var(--color-green);">üë§ Jij</div>
                                <div class="dice-cup" id="playerDiceCup">
                                    <div class="dice-container">
                                        <div class="dice" id="myDice1">‚öÄ</div>
                                        <div class="dice" id="myDice2">‚öÄ</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Opponent's Dice Cup -->
                            <div class="dice-cup-wrapper">
                                <div class="text-xs mb-2 text-center font-semibold" style="color: var(--color-red);"><span id="opponentDiceCupLabel">üéØ Tegenstander</span></div>
                                <div class="dice-cup opponent-cup" id="opponentDiceCup">
                                    <div class="dice-container">
                                        <div class="dice" id="opponentDice1">‚öÄ</div>
                                        <div class="dice" id="opponentDice2">‚öÄ</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Throw Value Display -->
                        <div id="currentThrowValue" class="text-center text-2xl font-bold mb-4" style="color: var(--color-gold);"></div>

                        <!-- Action Buttons -->
                        <div id="actionButtons" class="space-y-3">
                            <button type="button" class="btn-game btn-primary w-full hidden" id="throwOpenBtn">
                                üé≤ Gooi Open
                            </button>
                            <button type="button" class="btn-game btn-secondary w-full" id="throwBlindBtn">
                                üôà Gooi Blind
                            </button>
                            <button type="button" class="btn-game btn-secondary w-full hidden" id="keepBtn">
                                ‚úì Laten Staan
                            </button>
                            <button type="button" class="btn-game btn-primary w-full hidden" id="revealBtn">
                                üëÅÔ∏è Laten Zien
                            </button>
                            <!-- Result knoppen VERWIJDERD - automatische vergelijking! -->
                            <button type="button" class="btn-game btn-danger w-full hidden" id="giveUpBtn">
                                ‚ùå Pas
                            </button>
                        </div>

                        <!-- Game Result -->
                        <div id="gameResult" class="hidden mt-6 p-6 rounded-xl text-center" style="background: var(--bg-secondary);">
                            <h2 id="resultTitle" class="text-3xl font-heading font-bold mb-4"></h2>
                            <p id="resultMessage" class="text-lg mb-6" style="color: var(--text-primary);"></p>
                            <div class="flex gap-4 justify-center">
                                <button id="requestRematchBtn" class="btn-game btn-secondary px-8 py-3 rounded-xl shadow-lg hidden">
                                    üîÑ Revanche aanvragen
                                </button>
                                <button id="returnLobbyBtn" class="btn-game btn-primary px-8 py-3 rounded-xl shadow-lg">
                                    üè† Terug naar Lobby
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Connection Status Indicator -->
    <div id="connectionStatus" class="connection-status connected hidden">
        <div class="connection-status-dot"></div>
        <span id="connectionStatusText">Verbonden</span>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- Debug Log Panel -->
    <div id="debugPanel" class="fixed bottom-4 left-4 z-50 hidden bg-black bg-opacity-90 text-green-400 font-mono text-xs p-4 rounded-lg shadow-2xl max-w-lg" style="max-height: 400px; width: 500px;">
        <div class="flex justify-between items-center mb-2 border-b border-green-600 pb-2">
            <span class="font-bold text-green-300">üêõ Debug Log</span>
            <div class="flex gap-2">
                <button id="copyDebugBtn" class="px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs">
                    üìã Copy
                </button>
                <button id="clearDebugBtn" class="px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-xs">
                    Clear
                </button>
            </div>
        </div>
        <div id="debugLog" class="overflow-y-auto space-y-1" style="max-height: 340px;"></div>
    </div>

    <!-- Spelregels Parchment Modal -->
    <div id="spelregelsModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[60] hidden" style="backdrop-filter: blur(3px);">
        <div class="relative max-w-2xl w-full mx-4 animate-fade-in">
            <!-- Close Button -->
            <button id="closeSpelregelsModal" class="absolute -top-4 -right-4 w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold z-10 shadow-xl transition hover:scale-110" style="background: linear-gradient(135deg, #8B0000, #B22222); color: white;">
                ‚úï
            </button>

            <!-- Parchment Container -->
            <div class="relative rounded-2xl shadow-2xl overflow-hidden" style="background: linear-gradient(to bottom, #F4E4C1, #E8D4A8, #DCC895);">
                <!-- Ornate Border -->
                <div class="absolute inset-0 pointer-events-none" style="background: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><rect fill=\"none\" stroke=\"%23654321\" stroke-width=\"0.5\" x=\"2\" y=\"2\" width=\"96\" height=\"96\" rx=\"4\"/><rect fill=\"none\" stroke=\"%23654321\" stroke-width=\"0.3\" x=\"4\" y=\"4\" width=\"92\" height=\"92\" rx=\"3\"/></svg>'); background-size: 100% 100%;"></div>

                <!-- Aged Paper Texture Overlay -->
                <div class="absolute inset-0 pointer-events-none opacity-10" style="background-image: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><filter id=\"noise\"><feTurbulence type=\"fractalNoise\" baseFrequency=\"0.9\" numOctaves=\"4\" /></filter><rect width=\"100\" height=\"100\" filter=\"url(%23noise)\" opacity=\"0.3\"/></svg>'); mix-blend-mode: multiply;"></div>

                <!-- Content -->
                <div class="relative p-8 max-h-[80vh] overflow-y-auto" style="font-family: 'Georgia', 'Times New Roman', serif;">
                    <!-- Royal Crest -->
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-3">üëë</div>
                        <div class="flex items-center justify-center gap-2 mb-2">
                            <span class="text-3xl">üé≤</span>
                            <h2 class="text-4xl font-bold tracking-wide" style="color: #654321; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); font-family: 'Cinzel', serif;">
                                De Spelregels des Koninkrijks
                            </h2>
                            <span class="text-3xl">üé≤</span>
                        </div>
                        <div class="h-1 w-32 mx-auto rounded" style="background: linear-gradient(to right, transparent, #654321, transparent);"></div>
                    </div>

                    <!-- Main Content -->
                    <div class="space-y-6 text-lg leading-relaxed" style="color: #3E2723;">
                        <!-- Intro -->
                        <div>
                            <h3 class="text-2xl font-bold mb-4 text-center" style="color: #8B0000; font-family: 'Cinzel', serif;">
                                Het Legendarische B3-Verbond
                            </h3>
                            <p class="mb-4">
                                Laat het bekend zijn in den lande: Mexico-regels zijn er in meer smaken dan frikandelbroodjes bij de Appie.
                            </p>
                            <p class="mb-4">
                                Elke kroeg, elk dorp, elke vriendengroep zweert bij "de enige echte regels" ‚Äî die toevallig altijd net iets anders zijn dan die van de buren. Zo gaat dat al eeuwen en zo zal het blijven tot het einde der tijden (of tot de tap sluit).
                            </p>
                        </div>

                        <!-- Divider -->
                        <div class="flex items-center gap-3 my-6">
                            <div class="h-px flex-1" style="background: linear-gradient(to right, transparent, #654321, transparent);"></div>
                            <span class="text-2xl">‚öúÔ∏è</span>
                            <div class="h-px flex-1" style="background: linear-gradient(to right, #654321, transparent);"></div>
                        </div>

                        <!-- Big Three Section -->
                        <div>
                            <h4 class="text-xl font-bold mb-3" style="color: #0D5E3A; font-family: 'Cinzel', serif;">
                                Big Three (B3)
                            </h4>
                            <p class="mb-4">
                                Maar toen gebeurde het ondenkbare.
                            </p>
                            <p class="mb-4">
                                Drie Oost-Groningse dorpen ‚Äî <strong style="color: #0D5E3A;">Veendam</strong>, <strong style="color: #0D5E3A;">Muntendam</strong> en <strong style="color: #0D5E3A;">Oude Pekela</strong> ‚Äî normaal gesproken verwikkeld in het soort rivaliteit dat je alleen begrijpt als je er vandaan komt ‚Äî besloten de strijdbijl te begraven. Althans, voor even. Althans, voor M√©xico.
                            </p>
                            <p class="mb-4">
                                Het resultaat? <strong style="color: #D4AF37;">Big Three</strong>. Oftewel <strong style="color: #D4AF37;">B3</strong>.
                            </p>
                            <p class="mb-4">
                                Geen dorp de baas, geen ego voorrang. Gewoon drie plaatsen, drie meningen, √©√©n set regels waar iedereen zich in kon vinden. Een historisch moment, eigenlijk. Bijna ontroerend. Als je van dobbelspellen houdt.
                            </p>
                            <p class="mb-4 font-semibold" style="color: #8B0000;">
                                Dit zijn de regels waarmee wij hier spelen.
                            </p>
                        </div>

                        <!-- Divider -->
                        <div class="flex items-center gap-3 my-6">
                            <div class="h-px flex-1" style="background: linear-gradient(to right, transparent, #654321, transparent);"></div>
                            <span class="text-2xl">üé≤</span>
                            <div class="h-px flex-1" style="background: linear-gradient(to right, #654321, transparent);"></div>
                        </div>

                        <!-- Andere Regels Section -->
                        <div>
                            <h4 class="text-xl font-bold mb-3" style="color: #0D5E3A; font-family: 'Cinzel', serif;">
                                Andere Regels
                            </h4>
                            <p class="mb-4">
                                Zijn dit de enige M√©xico-regels ter wereld? Welnee! Er bestaan ook:
                            </p>
                            <ul class="list-none space-y-2 mb-4 pl-4">
                                <li>
                                    <strong style="color: #8B0000;">‚Üí</strong> <strong>De Muntendammer Regels van Marinus</strong> ‚Äî niemand weet precies wie Marinus is, maar zijn regels leven voort
                                </li>
                                <li>
                                    <strong style="color: #8B0000;">‚Üí</strong> <strong>De Pekel-regels</strong> ‚Äî recht uit Oude Pekela, voor de puristen
                                </li>
                            </ul>
                            <p class="mb-4">
                                Deze varianten zijn (nog) niet ingebouwd. Misschien ooit. Misschien nooit. Voorlopig is het B3 of niks.
                            </p>
                        </div>

                        <!-- Closing -->
                        <div class="text-center mt-8 pt-6" style="border-top: 2px solid #654321;">
                            <p class="italic mb-2" style="color: #654321;">
                                Heb je andere regels geleerd en voelt dit allemaal verkeerd? Wennen. Of stuur een boze mail.
                            </p>
                            <div class="text-4xl mt-4">
                                üé≤üëëüé≤
                            </div>
                        </div>

                        <!-- CTA Button -->
                        <div class="mt-8 pt-6 flex justify-center" style="border-top: 1px dashed #654321;">
                            <a href="spelregels.html" class="inline-flex items-center gap-3 px-8 py-4 rounded-xl font-bold text-xl transition transform hover:scale-105 shadow-xl" style="background: linear-gradient(135deg, #0D5E3A, #1B7A4B); color: white; text-decoration: none; font-family: 'Cinzel', serif;">
                                <span class="text-2xl">üìú</span>
                                <span>Lees de volledige spelregels</span>
                                <span class="text-2xl">‚öîÔ∏è</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }

        /* Scrollbar styling for parchment modal */
        #spelregelsModal ::-webkit-scrollbar {
            width: 10px;
        }

        #spelregelsModal ::-webkit-scrollbar-track {
            background: #D4AF37;
            border-radius: 5px;
        }

        #spelregelsModal ::-webkit-scrollbar-thumb {
            background: #654321;
            border-radius: 5px;
        }

        #spelregelsModal ::-webkit-scrollbar-thumb:hover {
            background: #3E2723;
        }
    </style>

    <script src="multiplayer.js"></script>
</body>
</html>
